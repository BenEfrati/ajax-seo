/*! Modified jQuery Address | (c) 2013 Rostislav Hristov | jquery.org/license */
(function(a){a.address=(function(){var d=function(ak){var al=a.extend(a.Event(ak),(function(){var ap={},ao=a.address.parameterNames();for(var an=0,am=ao.length;an<am;an++){ap[ao[an]]=a.address.parameter(ao[an])}return{value:a.address.value(),path:a.address.path(),pathNames:a.address.pathNames(),parameterNames:ao,parameters:ap,queryString:a.address.queryString()}}).call(a.address));a(a.address).trigger(al);return al},j=function(ak){return Array.prototype.slice.call(ak)},H=function(am,al,ak){a().on.apply(a(a.address),Array.prototype.slice.call(arguments));return a.address},U=function(al,ak){a().off.apply(a(a.address),Array.prototype.slice.call(arguments));return a.address},O=function(){return(ad.pushState&&C.state!==I)},G=function(){return("/"+Z.pathname.replace(new RegExp(C.state),"")+Z.search+(V()?"#"+V():"")).replace(Q,"/")},V=function(){var ak=Z.href.indexOf("#!");return ak!=-1?B(Z.href.substr(ak+1),ae):""},x=function(){return O()?G():V()},b=function(){try{return top.document!==I&&top.document.title!==I?top:window}catch(ak){return window}},k=function(){return"javascript"},ai=function(ak){ak=ak.toString();return(C.strict&&ak.substr(0,1)!="/"?"/":"")+ak},B=function(ak,al){if(C.crawlable&&al){return(ak!==""?"!":"")+ak}return ak.replace(/^\!/,"")},T=function(ak,al){return parseInt(ak.css(al),10)},ac=function(){if(!r){var al=x(),ak=decodeURI(X)!=decodeURI(al);if(ak){if(h&&p<7){Z.reload()}else{if(h&&!P&&C.history){m(D,50)}X=al;aa(ae)}}}},aa=function(ak){m(u,10);return d(F).isDefaultPrevented()||d(ak?g:ah).isDefaultPrevented()},u=function(){if(C.tracker!=="null"&&C.tracker!==E){var ak=a.isFunction(C.tracker)?C.tracker:R[C.tracker],al=(Z.pathname+Z.search+(a.address&&!O()?a.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");if(a.isFunction(ak)){ak(al)}else{if(a.isFunction(R.urchinTracker)){R.urchinTracker(al)}else{if(R.pageTracker!==I&&a.isFunction(R.pageTracker._trackPageview)){R.pageTracker._trackPageview(al)}else{if(R._gaq!==I&&a.isFunction(R._gaq.push)){R._gaq.push(["_trackPageview",decodeURI(al)])}}}}}},D=function(){var ak=k()+":"+ae+";document.open();document.writeln('<html><head><title>"+ag.title.replace(/\'/g,"\\'")+"</title><script>var "+w+' = "'+encodeURIComponent(x()).replace(/\'/g,"\\'")+(ag.domain!=Z.hostname?'";document.domain="'+ag.domain:"")+"\";<\/script></head></html>');document.close();";if(p<7){e.src=ak}else{e.contentWindow.location.replace(ak)}},af=function(){if(i&&c!=-1){var ak,am,al=i.substr(c+1).split("&");for(ak=0;ak<al.length;ak++){am=al[ak].split("=");if(/^(autoUpdate|crawlable|history|strict|wrap)$/.test(am[0])){C[am[0]]=(isNaN(am[1])?/^(true|yes)$/i.test(am[1]):(parseInt(am[1],10)!==0))}if(/^(state|tracker)$/.test(am[0])){C[am[0]]=am[1]}}i=E}X=x()},S=function(){if(!Y){Y=A;af();a('a[rel*="address:"]').address();if(C.wrap){var al=a("body"),am=a("body > *").wrapAll('<div style="padding:'+(T(al,"marginTop")+T(al,"paddingTop"))+"px "+(T(al,"marginRight")+T(al,"paddingRight"))+"px "+(T(al,"marginBottom")+T(al,"paddingBottom"))+"px "+(T(al,"marginLeft")+T(al,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+w+'" style="height:100%;overflow:auto;position:relative;'+(q&&!window.statusbar.visible?"resize:both;":"")+'" />');a("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"});if(q){a('<style type="text/css" />').appendTo("head").text("#"+w+"::-webkit-resizer { background-color: #fff; }")}}if(h&&!P){var ak=ag.getElementsByTagName("frameset")[0];e=ag.createElement((ak?"":"i")+"frame");e.src=k()+":"+ae;if(ak){ak.insertAdjacentElement("beforeEnd",e);ak[ak.cols?"cols":"rows"]+=",0";e.noResize=A;e.frameBorder=e.frameSpacing=0}else{e.style.display="none";e.style.width=e.style.height=0;e.tabIndex=-1;ag.body.insertAdjacentElement("afterBegin",e)}m(function(){a(e).on("load",function(){var an=e.contentWindow;X=an[w]!==I?an[w]:"";if(X!=x()){aa(ae);Z.hash=B(X,A)}});if(e.contentWindow[w]===I){D()}},50)}m(function(){d("init");aa(ae)},1);if(!O()){if((h&&p>7)||(!h&&P)){if(R.addEventListener){R.addEventListener(W,ac,ae)}else{if(R.attachEvent){R.attachEvent("on"+W,ac)}}}else{s(ac,50)}}if("state" in window.history){a(window).trigger("popstate")}}},o=function(){if(decodeURI(X)!=decodeURI(x())){X=x();aa(ae)}},n=function(){if(R.removeEventListener){R.removeEventListener(W,ac,ae)}else{if(R.detachEvent){R.detachEvent("on"+W,ac)}}},M=function(al){al=al.toLowerCase();var ak=/(chrome)[ \/]([\w.]+)/.exec(al)||/(webkit)[ \/]([\w.]+)/.exec(al)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(al)||/(msie) ([\w.]+)/.exec(al)||al.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(al)||[];return{browser:ak[1]||"",version:ak[2]||"0"}},L=function(){var al={},ak=M(navigator.userAgent);if(ak.browser){al[ak.browser]=true;al.version=ak.version}if(al.chrome){al.webkit=true}else{if(al.webkit){al.safari=true}}return al},I,E=null,w="jQueryAddress",ab="string",W="hashchange",l="init",F="change",g="internalChange",ah="externalChange",A=true,ae=false,C={autoUpdate:A,crawlable:A,history:A,strict:A,wrap:ae},z=L(),p=parseFloat(z.version),q=z.webkit||z.safari,h=!a.support.opacity,R=b(),ag=R.document,ad=R.history,Z=R.location,s=setInterval,m=setTimeout,Q=/\/{2,9}/g,aj=navigator.userAgent,P="on"+W in R,e,K,i=a("script:last").attr("src"),c=i?i.indexOf("?"):-1,J=ag.title,r=ae,Y=ae,N=A,v=ae,y={},X=x();if(h){p=parseFloat(aj.substr(aj.indexOf("MSIE")+4));if(ag.documentMode&&ag.documentMode!=p){p=ag.documentMode!=8?7:8}var t=ag.onpropertychange;ag.onpropertychange=function(){if(t){t.call(ag)}if(ag.title!=J&&ag.title.indexOf("#!"+x())!=-1){ag.title=J}}}if(ad.navigationMode){ad.navigationMode="compatible"}if(document.readyState=="complete"){var f=setInterval(function(){if(a.address){S();clearInterval(f)}},50)}else{af();a(S)}a(window).on("popstate",o).on("unload",n);return{on:function(al,am,ak){return H.apply(this,j(arguments))},off:function(al,ak){return U.apply(this,j(arguments))},init:function(al,ak){return H.apply(this,[l].concat(j(arguments)))},change:function(al,ak){return H.apply(this,[F].concat(j(arguments)))},internalChange:function(al,ak){return H.apply(this,[g].concat(j(arguments)))},externalChange:function(al,ak){return H.apply(this,[ah].concat(j(arguments)))},baseURL:function(){var ak=Z.href;if(ak.indexOf("#")!=-1){ak=ak.substr(0,ak.indexOf("#"))}if(/\/$/.test(ak)){ak=ak.substr(0,ak.length-1)}return ak},autoUpdate:function(ak){if(ak!==I){C.autoUpdate=ak;return this}return C.autoUpdate},crawlable:function(ak){if(ak.length!==I){C.crawlable=ak;return this}return C.crawlable},history:function(ak){if(ak!==I){C.history=ak;return this}return C.history},state:function(ak){if(ak!==I){C.state=ak;var al=G();if(C.state!==I){if(O()){if(al.substr(0,3)=="/#/"){Z.replace(C.state.replace(/^\/$/,"")+al.substr(2))}}else{if(al!="/"&&al.replace(/^\/#/,"")!=V()){m(function(){Z.replace(C.state.replace(/^\/$/,"")+"/#!"+al)},1)}}}return this}return C.state},strict:function(ak){if(ak!==I){C.strict=ak;return this}return C.strict},tracker:function(ak){if(ak!==I){C.tracker=ak;return this}return C.tracker},wrap:function(ak){if(ak!==I){C.wrap=ak;return this}return C.wrap},update:function(){v=A;this.value(X);v=ae;return this},title:function(ak){if(ak!==I){m(function(){J=ag.title=ak;if(N&&e&&e.contentWindow&&e.contentWindow.document){e.contentWindow.document.title=ak;N=ae}},50);return this}return ag.title},value:function(ak){if(ak!==I){ak=ai(ak);if(ak=="/"){ak=""}if(X==ak&&!v){return}X=ak;if(C.autoUpdate||v){if(aa(A)){return this}if(O()){ad[C.history?"pushState":"replaceState"]({},"",C.state.replace(/\/$/,"")+(X===""?"/":X))}else{r=A;if(q){X=X.length?"#"+B(X,A):"";if(C.history){Z.hash=X}else{Z.replace(X)}}else{if(X!=x()){X=X.length?"#"+B(X,A):"";if(C.history){Z.hash=X}else{Z.replace(X)}}}if((h&&!P)&&C.history){m(D,50)}if(q){m(function(){r=ae},1)}else{r=ae}}}return this}return ai(X)},path:function(al){if(al!==I){var ak=this.queryString(),am=this.hash();this.value(al+(ak?"?"+ak:"")+(am?"#"+am:""));return this}return ai(X).split("#")[0].split("?")[0]},pathNames:function(){var al=this.path(),ak=al.replace(Q,"/").split("/");if(al.substr(0,1)=="/"||al.length===0){ak.splice(0,1)}if(al.substr(al.length-1,1)=="/"){ak.splice(ak.length-1,1)}return ak},queryString:function(al){if(al!==I){var am=this.hash();this.value(this.path()+(al?"?"+al:"")+(am?"#"+am:""));return this}var ak=X.split("?");return ak.slice(1,ak.length).join("?").split("#")[0]},parameter:function(al,au,an){var ar,ap;if(au!==I){var at=this.parameterNames();ap=[];au=au===I||au===E?"":au.toString();for(ar=0;ar<at.length;ar++){var ao=at[ar],av=this.parameter(ao);if(typeof av==ab){av=[av]}if(ao==al){av=(au===E||au==="")?[]:(an?av.concat([au]):[au])}for(var aq=0;aq<av.length;aq++){ap.push(ao+"="+av[aq])}}if(a.inArray(al,at)==-1&&au!==E&&au!==""){ap.push(al+"="+au)}this.queryString(ap.join("&"));return this}au=this.queryString();if(au){var ak=[];ap=au.split("&");for(ar=0;ar<ap.length;ar++){var am=ap[ar].split("=");if(am[0]==al){ak.push(am.slice(1).join("="))}}if(ak.length!==0){return ak.length!=1?ak:ak[0]}}},parameterNames:function(){var ak=this.queryString(),an=[];if(ak&&ak.indexOf("=")!=-1){var ao=ak.split("&");for(var am=0;am<ao.length;am++){var al=ao[am].split("=")[0];if(a.inArray(al,an)==-1){an.push(al)}}}return an},hash:function(al){if(al!==I){this.value(X.split("#")[0]+(al?"#"+al:""));return this}var ak=X.split("#");return ak.slice(1,ak.length).join("#")}}})();a.fn.address=function(b){if(!this.data("address")){this.on("click",function(f){if(f.shiftKey||f.ctrlKey||f.metaKey||f.which==2){return true}var d=f.currentTarget;if(a(d).is("a")){f.preventDefault();var c=b?b.call(d):/address:/.test(a(d).attr("rel"))?a(d).attr("rel").split("address:")[1].split(" ")[0]:a.address.state()!==undefined&&!/^\/?$/.test(a.address.state())?a(d).attr("href").replace(new RegExp("^(.*"+a.address.state()+"|\\.)"),""):a(d).attr("href").replace(/^(#\!?|\.)/,"");a.address.value(c)}}).on("submit",function(g){var f=g.currentTarget;if(a(f).is("form")){g.preventDefault();var d=a(f).attr("action"),c=b?b.call(f):(d.indexOf("?")!=-1?d.replace(/&$/,""):d+"?")+a(f).serialize();a.address.value(c)}}).data("address",true)}return this}})(jQuery);