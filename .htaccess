Options -Indexes +FollowSymLinks -MultiViews

ServerSignature Off

php_flag display_errors 0
php_flag log_errors 1
php_value error_log error_log.txt
php_flag allow_url_fopen 1
php_value short_open_tag 1
php_flag magic_quotes_gpc 0
php_flag register_globals 0
#php_flag expose_php 0
php_value output_handler ob_gzhandler

AddType text/javascript .js
AddType application/json .json
AddType image/x-icon .ico

AddDefaultCharset utf-8
AddCharset utf-8 .json .css .js .txt

<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE application/x-httpd-php application/json text/html text/plain text/css text/javascript image/svg+xml image/x-icon
    <IfModule mod_setenvif.c>
        BrowserMatch ^Mozilla/4 gzip-only-text/html
        BrowserMatch ^Mozilla/4\.0[678] no-gzip
        BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
        <IfModule mod_headers.c>
            BrowserMatch MSIE ie
            Header set X-UA-Compatible "IE=Edge,chrome=1" env=ie
        </IfModule>
    </IfModule>
</IfModule>
<IfModule mod_gzip.c>
    mod_gzip_on Yes
    mod_gzip_can_negotiate Yes
    mod_gzip_static_suffix .gz
    AddEncoding gzip .gz
    mod_gzip_update_static No
    mod_gzip_keep_workfiles No
    mod_gzip_minimum_file_size 500
    mod_gzip_maximum_file_size 5000000
    mod_gzip_maximum_inmem_size 60000
    mod_gzip_min_http 1000
    mod_gzip_dechunk Yes
    mod_gzip_handle_methods GET POST
    #mod_gzip_item_exclude reqheader \"User-agent: Mozilla/4.0[678]\"
    mod_gzip_item_include file \.(php|css|json|js|css|txt|ico)$
    mod_gzip_item_include mime ^text/html$
    mod_gzip_item_include mime ^text/plain$
    mod_gzip_item_include mime ^text/css$
    mod_gzip_item_include mime ^text/javascript$
    mod_gzip_item_include mime ^application/json$
    mod_gzip_item_include mime ^application/x-httpd-php$
    mod_gzip_item_include mime ^image/svg+xml$
    mod_gzip_item_include mime ^image/x-icon$
    mod_gzip_item_include mime ^httpd/unix-directory$
    mod_gzip_item_include handler ^proxy-server$
    mod_gzip_item_exclude rspheader ^Content-Encoding:.*gzip.*
    mod_gzip_send_vary On
</IfModule>
<ifModule mod_expires.c>
    ExpiresActive On
    ExpiresDefault "access plus 1 month"
    ExpiresByType text/css "access plus 6 months"
    ExpiresByType text/plain "access plus 1 hour"
    ExpiresByType text/javascript "access plus 6 months"
    ExpiresByType application/x-httpd-php "access plus 0 second"
    ExpiresByType application/json "access plus 0 second"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/x-icon "access plus 1 week"
    ExpiresByType image/vnd.microsoft.icon "access plus 1 week"
    ExpiresByType image/svg+xml "access plus 1 month"
</ifModule>
<ifModule mod_headers.c>
    <FilesMatch "\.(png|jpg|gif|svg)$">
        Header set Cache-Control "public, max-age=2419200"
    </FilesMatch>
    <filesMatch "\.(css|js|json|txt)$">
        Header set Cache-Control "public, max-age=31536000"
        #Header set X-Robots-Tag none
        #Header append Vary "Accept-Encoding, User-Agent"
        Header append Vary Accept-Encoding
        #Header set Content-Encoding: gzip
    </filesMatch>
    <filesMatch "\.(php)$">
        Header set Cache-Control "private, must-revalidate, max-age=600"
        #Header set Imagetoolbar no
    </filesMatch>
    FileETag None
    Header unset ETag
    Header unset Last-Modified
    Header set X-Content-Type-Options: nosniff
    #Header set Transfer-Encoding: chunked
</ifModule>
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Ajax SEO crawl /?_escaped_fragment_=url redirect to /url
    RewriteCond %{QUERY_STRING} ^_escaped_fragment_=(.*)$
    RewriteRule .*$ %{REQUEST_URI}%1? [R=301,L]
    
    # Rewrite multiple slashes with single slash after domain
    RewriteCond %{THE_REQUEST} ^[A-Z]+\s//+(.*)\sHTTP/[0-9.]+$ [OR]
    RewriteCond %{THE_REQUEST} ^[A-Z]+\s(.*/)/+\sHTTP/[0-9.]+$
    RewriteRule .* http://%{HTTP_HOST}/%1 [R=301,L,NE]
    
    # Rewrite multiple slashes with single slash in URL
    RewriteCond %{REQUEST_URI} ^(.*)//(.*)$
    RewriteRule . %1/%2 [R=301,NE,L]
    
    # Remove slash from URL end
    RewriteCond %{REQUEST_URI} ^(.+)/$
    RewriteRule ^.+/$ %1 [R=301,NE,L]
    
    # Rewrite backslash with slash
    ## works on FF with using AllowEncodedSlashes On in httpd.conf
    RewriteCond %{REQUEST_URI} ^(.*)\\(.*)$
    RewriteRule .* %1/%2 [R=301,NC,L]
    
    # Rewrite space with dash
    RewriteCond %{REQUEST_URI} ^([^\ ]*)\ (.*)$
    RewriteRule .* %1-%2 [R=301,L]
    
    # Rewrite underscore with dash
    RewriteCond %{REQUEST_URI} ^([^\_]*)\_(.*)$
    RewriteRule .* %1-%2 [R=301,L]
    
    # Remove comma
    RewriteCond %{REQUEST_URI} ^([^\,]*)\,(.*)$
    RewriteRule .* %1%2 [R=301,L]
    
    # Remove dot before slash
    RewriteCond %{REQUEST_URI} ^(.*)\./(.*)$
    RewriteRule ^(.*)\./(.*)$  %1/%2 [R=301,L]
    
    # Remove dot after slash
    RewriteCond %{REQUEST_URI} ^(.*)/\.(.*)$
    RewriteRule ^(.*)/\.(.*)$ %1/%2 [R=301,L]
    
    # Remove .php extension
    RewriteCond %{THE_REQUEST} ^[A-Z]{3,9}\ /([^/]+/)*[^.]+\.php(\?[^\ ]*)?\ HTTP/ [NC]
    RewriteRule ^(([^/]+/)*[^.]+)\.php$ http://%{HTTP_HOST}/%1$1 [R=301,L]
    
    # Rewrite uppercase letter URL to lowercase
    ## solution without using RewriteMap in httpd.conf - https://github.com/laukstein/ajax-seo/wiki/Lowercase-URL
    RewriteCond %{REQUEST_URI} .+
    RewriteRule ^[^A-Z]*[A-Z] ${lc:%0} [R=301,L]
    
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^([^.]*)$ index.php?url=$1 [L,QSA]
    RewriteRule ^([^/\./-/+]*)\.json$ data.php?url=$1 [L,QSA]
</IfModule>